<!DOCTYPE html>
<html>
  <head>
    <title>MongoDB Tutorial</title>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="stylesheet" type="text/css" href="stylesheet.en.css"/>
    <!--
    <meta name="keywords" content="KW1, KW2, KW3"/>

    <meta name="author" content="AUTHOR"/>
    <meta name="description" content="A_DESCRIPTION"/>
    <meta name="FIELD_NAME" content="FIELD_VALUE"/>

    <link rel="alternate" hreflang="x-default" href="http://www.example.com/"/>
    <link rel="alternate" hreflang="es" href="http://es.example.com/"/>
    <link rel="alternate" hreflang="de" href="http://de.example.com/"/>

    <link rel="author" href="https://plus.google.com/ExampleProfile"/>
    <link rel="license" href="https://creativecommons.org/licenses/by/4.0/"/>
    -->
  </head>
  <body lang="en" class="computing">
    <nav>
    <!-- -->
      <div>
        <p><a rel="prev" href="mongodb.html">MongoDB: A JSON Document Database</a></p>
        <p><a             href="https://docs.mongodb.com/manual/">Documentation</a> (at <cite>https://docs.mongodb.com/manual/</cite>)</p>
        <p><a            href="json.html">JavaScript Object Notation</a></p>
        <p><a            href="js.html">JavaScript: a Programming Language for MongoDB and the Web</a></p>
      </div>
      <div>
        <p><a            href="https://github.com/proyecto-eden-3-esferas/DataBases/">My (SQL) DataBases for Farming, Biology, Health etc.</a></p>
        <p><a            href="https://github.com/proyecto-eden-3-esferas/SQLite/">Handling SQLite through C++ (Code)</a></p>
      </div>

    </nav>


    <main>

      <h1>MongoDB Tutorial</h1>
      <p>Having learned how to <a target="_blank" href="mongodb.html#install">install</a> and log in into MongoDB, we go on to manage our databases:</p>
      <nav>
        <p><a                 href="#managing">Handling DataBases and Collections</a></p>
        <p><a target="_blank" href="mongodb.querying.html">Querying and Indexing a MongoDB Database</a></p>
        <p><a                 href="#insert">Inserting (Objects) in MongoDB</a></p>
        <p><a                 href="#update">Updating Documents</a></p>
        <p><a                 href="#remove">Removing Documents</a></p>
        <p><a                 href="#io">Outputing to and Inputing from a File</a></p>
        <p><a                 href="#schema-validation">MongoDB Schema Validation</a></p>
        <p><a                 href="#mongoimport">Inputing from a File with <code class="command">mongoimport</code></a></p>
      </nav>


      <section id="managing">
        <h2>Handling DataBases</h2>
        <section>
          <h3>Finding Which Database(s) you are <q>Using</q> Currently</h3>
          <p>After connecting to your database using <code>mongosh</code>, you can see which database you are using by typing <code>db</code> in your terminal.</p>
          <p>If you have used the connection string provided from the MongoDB Atlas dashboard, you should be connected to the <var>myFirstDatabase</var> database.</p>
        </section>
        <section>
          <h3>Collections in MongoDB</h3>
          <p>A <dfn>collection</dfn> is a set of JSON objects, and is analogous to a table in a relational database.</p>
          <ul>
            <li>
              <p>To create a collection issue: <kbd>db.createCollection("myCollection")</kbd></p>
            </li>
            <li>
              <p>To insert data into a (possibly non-existent) collection issue: <kbd>db.myCollection.insert({"name": "john", "age" : 22, "location": "colombo"})</kbd></p>
            </li>
          </ul>
        </section>
        <section>
          <h3>Show all Databases or all Collections</h3>
          <p>To see all available databases, in your terminal type <code>show databases</code> or <code>show dbs</code>.</p>
          <p>To see all available collections, in your terminal type <code>show collections</code> or <code>show tables</code>.</p>
          <hr/>
          <p>Notice that <var>myFirstDatabase</var> is not listed. This is because the database is empty. An empty database is essentially non-existant.</p>
        </section>
        <section>
          <h3>Change or Create a Database or Create a Collection</h3>
          <p>You can change or create a new database by typing <code>use</code> then the name of the database.</p>
          <h4>Example</h4>
          <p>Create a new database called <var>blog</var>:</p>
          <pre>use blog</pre>
          <p>We are now in the <var>blog</var> database.</p>
          <p>If database <var>blog</var> already existed, then <code>use blog</code> would just change into database <var>blog</var>.</p>
          <p><strong>Remember:</strong> In MongoDB, a database is not actually created until it gets content!</p>
        </section>
      </section>

      <section id="insert">
        <h2>Inserting (Objects) in MongoDB</h2>
        <ul>
          <li>
            <p>To insert one data item in a collection issue:</p>
            <pre>>db.myCollection.insertOne(
  {
    "name": "navindu",
    "age": 22
  }
)</pre>
          </li>
          <li>
            <p>To insert several comma-separated data items in a collection issue:</p>
            <pre>db.myCollection.insertMany([
  {
  "name": "navindu",
  "age": 22
  },
  {
  "name": "kavindu",
  "age": 20
  },

  {
  "name": "john doe",
  "age": 25,
  "location": "colombo"
  }
])</pre>
          </li>
          <li>The <code class="function">insert()</code> method is similar to the <code class="function">insertMany()</code> method.</li>
        </ul>
      </section>


      <section>
        <h2>Special Index and Collection Types*</h2>
      </section>

      <section>
        <h2>Introduction to the Aggregation Framework*</h2>
      </section>



      <section id="update">
        <h2>Updating Documents</h2>
        <ul>
          <li>To update someone's age issue: <kbd>db.myCollection.update({age : 20}, {$set: {age: 23}})</kbd></li>
        </ul>
      </section>
      <section id="remove">
        <h2>Removing Documents</h2>
        <ul>
          <li>To remove a property (i.e. a key-value pair), issue: <kbd>db.myCollection.update({name: "navindu"}, {$unset: age});</kbd></li>
          <li>To remove one document, issue: <kbd>db.myCollection.remove({name: "navindu"});</kbd></li>
          <li>To remove a whole collection, issue: <kbd>db.myCollection.remove({});</kbd>. Note, this is not equal to the <code>drop()</code> method. The difference is that <code>drop()</code> is used to remove all the documents inside a collection, but the <code>remove()</code> method is used to delete all the documents along with the collection itself.</li>
        </ul>
      </section>
      <section id="io">
        <h2>Outputing to and Inputing from a File</h2>
        <p>You can log all the shell session if you invoked the shell with tee command: <kbd>mongo | tee session.txt</kbd>. Or you can use the <kbd>--eval</kbd> switch like so: <kbd>mongo localhost:27017/dbname --eval "printjson(db.MyCollection.find().pretty())" &gt; sample.json</kbd>.</p>
        <section>
          <h3>Outputing to a File with <code class="command">mongoexport</code></h3>
          <ul>
            <li>To get all documents in collection crops, in database farming, into file <filename>farming.crops.json</filename>, issue: <kbd>mongoexport --db=farming --collection=crops --out="farming.crops.json" --pretty</kbd></li>
            <li>To get results as an array, add <kbd>--jsonArray</kbd>, as in: <kbd>mongoexport --db=farming --collection=crops --out="farming.crops.json" --pretty --jsonArray</kbd></li>
            <li>You can select which fields to get through <kbd>-f, --fields=&lt;field&gt;[,&lt;field&gt;]*</kbd> (a comma separated list of field names (required for exporting CSV) e.g. -f "name,age") or <kbd>--fieldFile=&lt;filename&gt;</kbd> (a file with field names, one per line)</li>
            <li>You can specify a query filter through <kbd>-q, --query=&lt;json&gt;</kbd>, such as <kbd>{x:{$gt:1}}</kbd>, or set a path to a query file  containing a query filter for JSON files, through <kbd>--queryFile=&lt;filename&gt;</kbd></li>
          </ul>
        </section>
      </section>

      <section id="schema-validation">
        <h2>MongoDB Schema Validation</h2>
        <p>By default MongoDB has a flexible schema, unlike <a target="_blank" href="relational-database.html">Relational DataBases</a>. This means that there is no strict schema validation set up initially.</p>
        <p>Schema validation rules can be created in order to ensure that all documents in a collection share a similar structure.</p>

        <p>MongoDB supports <a target="_blank" href="json.html#validation">JSON Schema validation</a>. The <code>$jsonSchema</code> operator allows us to define our document structure.</p>
        <pre>db.createCollection("posts", {
  validator: {
    $jsonSchema: {
      bsonType: "object",
      required: [ "title", "body" ],
      properties: {
        title: {
          bsonType: "string",
          description: "Title of post - Required."
        },
        body: {
          bsonType: "string",
          description: "Body of post - Required."
        },
        category: {
          bsonType: "string",
          description: "Category of post - Optional."
        },
        likes: {
          bsonType: "int",
          description: "Post like count. Must be an integer - Optional."
        },
        tags: {
          bsonType: ["string"],
          description: "Must be an array of strings - Optional."
        },
        date: {
          bsonType: "date",
          description: "Must be a date - Optional."
        }
      }
    }
  }
})</pre>
        <p>This will create the posts collection in the current database and specify the JSON Schema validation requirements for the collection.</p>
      </section>  <!-- end of "MongoDB Schema Validation" -->

      <section id="mongoimport">
        <h2>Inputing from a File with <code class="command">mongoimport</code></h2>
        <p>Switches <kbd>--db</kbd>, <kbd>--collections</kbd>, <kbd>--fields</kbd>, <kbd>--fieldFile</kbd>, <kbd>--jsonArray</kbd> are the same as with <code class="command">mongoexport</code>.</p>
        <p>Command <code class="command">mongoimport</code> has some ingest switches, too:</p>
        <dl>
          <dt>
            <kbd>--drop</kbd>
          </dt>
          <dd>drop collection before inserting documents</dd>
          <dt>
            <kbd>--ignoreBlanks</kbd>
          </dt>
          <dd>ignore fields with empty values in CSV and TSV</dd>
          <dt>
            <kbd>--maintainInsertionOrder</kbd>
          </dt>
          <dd>insert documents in the order of their appearance in the input source</dd>
          <dt>
            <kbd>-j, --numInsertionWorkers=&lt;number&gt;</kbd>
          </dt>
          <dd>number of insert operations to run concurrently (defaults to 1) (default: 1)</dd>
          <dt>
            <kbd>--stopOnError</kbd>
          </dt>
          <dd>stop importing at first insert/upsert error</dd>
          <dt>
            <kbd>--mode=[insert|upsert|merge]</kbd>
          </dt>
          <dd>insert: insert only; upsert: insert or replace existing documents; merge: insert or modify existing documents; defaults to insert</dd>
          <dt>
            <kbd>--upsertFields=&lt;field&gt;[,&lt;field&gt;]*</kbd>
          </dt>
          <dd>comma-separated fields for the query part when --mode is set to upsert or merge</dd>
          <dt>
            <kbd>--writeConcern=&lt;write-concern-specifier&gt;</kbd>
          </dt>
          <dd>write concern options e.g. --writeConcern majority, --writeConcern '{w: 3, wtimeout: 500, fsync: true, j: true}'</dd>
          <dt>
            <kbd>--bypassDocumentValidation</kbd>
          </dt>
          <dd>bypass document validation</dd>
        </dl>
      </section>

    </main>

  </body>

</html>
